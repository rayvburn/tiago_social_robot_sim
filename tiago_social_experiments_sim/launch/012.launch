<?xml version="1.0" encoding="UTF-8"?>
<launch>
    <!-- === ARGUMENTS ========================================================================== -->
    <!-- (full|short|hard|static|dynamic) -->
    <arg name="scenario" default="static"/>

    <arg name="people_sim" default="true"/>
    <arg name="people_sim_viz" default="false"/>

    <!-- (titanium|steel|iron) -->
    <arg name="robot_type" default="iron"/>

    <arg name="perception_launch" default="true"/>

    <arg name="navigation_launch" default="true"/>
    <arg name="navigation_benchmark" default="true"/>

    <arg name="global_planner" default="navfn"/>
    <arg name="local_planner" default="hubero"/>
    <arg name="nav_state" default="localization"/>

    <!-- Run debugging tools -->
    <arg name="run_perception_viz" default="false"/>
    <arg name="run_nav_viz" default="true"/>
    <arg name="run_reconfigure" default="false"/>
    <arg name="run_plot" default="true"/>

    <!-- Automatic publishing of navigation goal -->
    <arg name="publish_goal" default="true"/>
    <arg name="goal_file" default="$(find tiago_social_experiments_sim)/config/012_goal.yaml"/>

    <arg name="shared_map" default="true"/>
    <!-- Results from Matlab script: `tf_world_map_calculation.m` -->
    <arg name="tf_world_map" value="-0.1920 -3.9164 +0.00 +0.1620 +0.00 +0.00"/>

    <arg name="map_file" value="$(find tiago_sim_integration)/maps/012_sim_localization/map.yaml"/>
    <arg name="map_frame" default="map"/>
    <arg name="map_bounds" value="[-2.49, 5.86, -2.74, 10.30]"/>

    <!-- resources for `012` lab world -->
    <env name="GAZEBO_MODEL_PATH" value="$(find tiago_sim_integration)/models:$(optenv GAZEBO_MODEL_PATH)"/>

    <!-- === NODES ============================================================================== -->
    <include file="$(find tiago_social_experiments_sim)/launch/scenario_base.launch">
        <arg name="people_sim" value="$(arg people_sim)"/>
        <arg name="people_sim_viz" value="$(arg people_sim_viz)"/>

        <arg name="robot_type" value="$(arg robot_type)"/>

        <arg name="perception_launch" value="$(arg perception_launch)"/>
        <arg name="navigation_launch" value="$(arg navigation_launch)"/>
        <arg name="navigation_benchmark" value="$(arg navigation_benchmark)"/>
        <arg name="global_planner" value="$(arg global_planner)"/>
        <arg name="local_planner" value="$(arg local_planner)"/>
        <arg name="nav_state" value="$(arg nav_state)"/>
        <arg name="run_perception_viz" value="$(arg run_perception_viz)"/>
        <arg name="run_nav_viz" value="$(arg run_nav_viz)"/>
        <arg name="run_reconfigure" value="$(arg run_reconfigure)"/>
        <arg name="run_plot" value="$(arg run_plot)"/>
        <arg name="publish_goal" value="$(arg publish_goal)"/>
        <arg name="publish_goal_delay" if="$(eval scenario == 'dynamic')" value="$(eval {'titanium': '110', 'steel': '110', 'iron': '70'}.get(arg('robot_type'), '70'))"/>

        <arg name="world_file_wo_people" value="$(find tiago_sim_integration)/worlds/lab_012_v2.world"/>
        <arg name="world_file_people" unless="$(eval scenario == 'dynamic')" value="$(find tiago_sim_integration)/worlds/lab_012_v2_actor.world"/>
        <arg name="world_file_people" if="$(eval scenario == 'dynamic')" value="$(find tiago_sim_integration)/worlds/lab_012_v2_actor_dynamic.world"/>

        <arg name="pose_sim" if="$(eval scenario == 'full')" value="-x 1.7 -y 5.6 -z -0.003 -R 0.0 -P 0.0 -Y -1.5708"/>
        <arg name="pose_sim" if="$(eval scenario == 'short')" value="-x 1.729204 -y -0.868255 -z -0.003 -R 0.0 -P 0.0 -Y -2.081408"/>
        <arg name="pose_sim" if="$(eval scenario == 'hard')" value="-x 0.2 -y -1.63 -z -0.003 -R 0.0 -P 0.0 -Y -1.5708"/>
        <arg name="pose_sim" if="$(eval scenario == 'static')"  value="-x +1.20 -y +4.50 -z -0.003 -R 0.0 -P 0.0 -Y 0.0"/>
        <arg name="pose_sim" if="$(eval scenario == 'dynamic')" value="-x -1.85 -y -4.00 -z -0.003 -R 0.0 -P 0.0 -Y 0.0"/>

        <arg name="localization_pose_estimate" if="$(eval scenario == 'full')" value="$(find tiago_social_experiments_sim)/config/012_pose_full.yaml"/>
        <arg name="localization_pose_estimate" if="$(eval scenario == 'hard')" value="$(find tiago_social_experiments_sim)/config/012_pose_hard.yaml"/>
        <arg name="localization_pose_estimate" if="$(eval scenario == 'short')" value="$(find tiago_social_experiments_sim)/config/012_pose_short.yaml"/>
        <arg name="localization_pose_estimate" if="$(eval scenario == 'static')"  value="$(find tiago_social_experiments_sim)/config/012_pose_static.yaml"/>
        <arg name="localization_pose_estimate" if="$(eval scenario == 'dynamic')" value="$(find tiago_social_experiments_sim)/config/012_pose_undock.yaml"/>

        <arg name="shared_map" value="$(arg shared_map)"/>
        <arg name="tf_world_map" value="$(arg tf_world_map)"/>

        <arg name="map_file" value="$(arg map_file)"/>
        <arg name="map_frame" value="$(arg map_frame)"/>

        <arg name="goal_file" if="$(eval scenario == 'full')" value="$(arg goal_file)"/>
        <arg name="goal_file" if="$(eval scenario == 'short')" value="$(arg goal_file)"/>
        <arg name="goal_file" if="$(eval scenario == 'hard')" value="$(arg goal_file)"/>
        <arg name="goal_file" if="$(eval scenario == 'static')" value="$(find tiago_social_experiments_sim)/config/012_goal_static.yaml"/>
        <arg name="goal_file" if="$(eval scenario == 'dynamic')" value="$(find tiago_social_experiments_sim)/config/012_goal_dynamic.yaml"/>
    </include>

    <!--
        Launch HuBeRo actors ROS interfaces. Note that it will significantly affect simulation performance.
    -->
    <group if="$(arg people_sim)">
        <include file="$(find hubero_ros)/launch/actor.launch">
            <arg name="actor_name" value="actor1"/>
            <arg name="local_planner" value="teb"/>
            <arg name="map_file" value="$(arg map_file)"/>
            <arg name="use_shared_map" value="$(arg shared_map)"/>
            <arg name="map_frame" value="$(arg map_frame)"/>
            <arg name="tf_world_map" value="$(arg tf_world_map)"/>
            <arg name="map_bounds" value="$(arg map_bounds)"/>
        </include>
        <include file="$(find hubero_ros)/launch/actor.launch">
            <arg name="actor_name" value="actor2"/>
            <arg name="local_planner" value="teb"/>
            <arg name="map_file" value="$(arg map_file)"/>
            <arg name="use_shared_map" value="$(arg shared_map)"/>
            <arg name="map_frame" value="$(arg map_frame)"/>
            <arg name="tf_world_map" value="$(arg tf_world_map)"/>
            <arg name="map_bounds" value="$(arg map_bounds)"/>
        </include>
        <!-- scenario node - orchestrates actors movements -->
        <node if="$(eval scenario == 'dynamic')" pkg="tiago_social_scenarios_sim" type="lab_012_hubero" name="lab_012_hubero" output="screen" args="1"/>
    </group>
</launch>

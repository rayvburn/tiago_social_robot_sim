<?xml version="1.0" encoding="UTF-8"?>
<launch>
    <!-- === ARGUMENTS ========================================================================== -->
    <arg name="people_sim" default="false"/>
    <arg name="people_sim_viz" default="false"/>

    <!-- (titanium|steel|iron) -->
    <arg name="robot_type" default="titanium"/>

    <arg name="perception_launch" default="false"/>
    <arg name="perception_viz" default="false"/>
    <arg name="perception_input_topic" default="/spencer/perception/tracked_persons"/>

    <!-- Set to true if navigation modules should be launched -->
    <arg name="navigation_launch" default="true"/>

    <!-- Set to true if navigation benchmark should be enabled -->
    <arg name="navigation_benchmark" default="false"/>

    <arg name="global_planner" default="navfn"/>
    <arg name="local_planner" default="teb"/>
    <arg name="nav_state" default="localization"/>

    <!-- Run debugging tools -->
    <arg name="run_nav_viz" default="false"/>
    <arg name="run_reconfigure" default="false"/>
    <arg name="run_plot" default="false"/>

    <!-- Automatic publishing of navigation goal -->
    <arg name="publish_goal" default="false"/>
    <arg name="publish_goal_delay" default="$(eval {'titanium': '50', 'steel': '50', 'iron': '15'}.get(arg('robot_type'), '15'))"/>
    <arg name="goal_file" default="provide_a_valid_yaml_with_sim_PoseStamped"/>

    <!--
        Related to HuBeRo bringup - set to true if HuBeRo actors static map should be shared with robot.
        Should be set to false if HuBeRo framework is not used (has effect only if `people_sim` is true)
    -->
    <arg name="shared_map" default="true"/>

    <!--
        `tf_world_map` should be computed using element-wise subtraction:
        robot_sim_init_pose - robot_map_init_pose
        Example inputs and result below:
        robot sim start: -x 1.7 -y 5.6 -z -0.003 -R 0.0 -P 0.0 -Y -1.5708
        robot init pose: x 3.587 y: 9.158 Y: -1.733
    -->
    <arg name="tf_world_map" default="-1.88 -3.55 +0.00 +0.00 +0.00 -0.1622"/>

    <arg name="pose_sim" default="-x 0.2 -y -1.63 -z -0.003 -R 0.0 -P 0.0 -Y -1.5708"/>
    <arg name="map_frame" default="map"/>

    <arg name="world_file_wo_people" default="$(find gazebo_ros)/worlds/empty.world"/>
    <arg name="world_file_people" default="$(find gazebo_ros)/worlds/empty.world"/>
    <arg name="map_file" default="provide_a_valid_YAML_with_sim_map_metadata"/>
    <arg name="localization_config" default="provide_a_valid_YAML_with_initial_sim_pose_for_AMCL"/>

    <!-- === NODES ============================================================================== -->
    <group if="$(arg people_sim)">
        <include file="$(find hubero_bringup_gazebo_ros)/launch/example.launch">
            <arg name="world" value="custom"/> <!-- ignores pre-defined bringup config -->
            <arg name="world_file" value="$(arg world_file_people)"/>
            <arg name="map_file" value="$(arg map_file)"/>
            <arg name="rviz" value="$(arg people_sim_viz)"/>
            <arg name="tf_world_map" value="$(arg tf_world_map)"/>
            <arg name="shared_map" value="$(arg shared_map)"/>
            <arg name="map_frame" value="$(arg map_frame)"/>
        </include>
        <!--
            NOTE: ROS interfaces for each actor must be launched for specific scenarios.
            Also, one should not use `people_sim:=true` without at least specyfing static TF.
            Otherwise robot will quickly start flickering.
        -->
    </group>
    <group unless="$(arg people_sim)">
        <include file="$(find gazebo_ros)/launch/empty_world.launch">
            <arg name="world_name" value="$(arg world_file_wo_people)"/>
            <arg name="paused" value="false"/>
            <arg name="use_sim_time" value="true"/>
            <arg name="gui" value="true"/>
            <arg name="headless" value="false"/>
            <arg name="debug" value="false"/>
            <arg name="verbose" value="true"/>
        </include>
    </group>

    <include file="$(find tiago_social_bringup_sim)/launch/gazebo_spawn.launch">
        <arg name="gzpose" value="$(arg pose_sim)"/>
        <arg name="robot" value="$(arg robot_type)"/>
    </include>

    <include file="$(find tiago_social_bringup)/launch/nav_perception_bringup.launch">
        <arg name="nav_state" value="$(arg nav_state)"/>
        <arg name="navigation_launch" value="$(arg navigation_launch)"/>
        <arg name="external_map" value="$(arg people_sim)"/>
        <arg name="map_file" value="$(arg map_file)"/>
        <arg name="global_planner" value="$(arg global_planner)"/>
        <arg name="local_planner" value="$(arg local_planner)"/>
        <arg name="localization_config" value="$(arg localization_config)"/>
        <arg name="navigation_benchmark" value="$(arg navigation_benchmark)"/>
        <arg name="perception_launch" value="$(arg perception_launch)"/>
        <arg name="perception_viz" value="$(arg perception_viz)"/>
        <arg name="perception_input_topic" value="$(arg perception_input_topic)"/>
        <arg name="publish_goal" value="$(arg publish_goal)"/>
        <arg name="publish_goal_delay" value="$(arg publish_goal_delay)"/>
        <arg name="goal_file" value="$(arg goal_file)"/>
        <!-- debugging tools -->
        <arg name="run_nav_viz" value="$(arg run_nav_viz)"/>
        <arg name="run_reconfigure" value="$(arg run_reconfigure)"/>
        <arg name="run_plot" value="$(arg run_plot)"/>
    </include>
</launch>
